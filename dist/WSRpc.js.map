{"version":3,"sources":["WSRpc.ts"],"names":["lg3x","lg3x.UUIDGenerator","lg3x.UUIDGenerator.constructor","lg3x.UUIDGenerator.generateUUID","lg3x.EventBus","lg3x.EventBus.constructor","lg3x.EventBus.getSharedEventBus","lg3x.EventBus.on","lg3x.EventBus.fire","lg3x.EventBus.remove","lg3x.RPCParser","lg3x.RPCParser.constructor","lg3x.RPCParser.isError","lg3x.RPCParser.isRequest","lg3x.RPCParser.isResponse","lg3x.RPCParser.getCode","lg3x.RPCParser.getErrorMessage","lg3x.RPCParser.getResult","lg3x.RPCParser.getParams","lg3x.RPCParser.isBroadcast","lg3x.RPCParser.getMethod","lg3x.RPCParser.getNamedInstance","lg3x.RPCParser.getId","lg3x.ObjectRegistry","lg3x.ObjectRegistry.constructor","lg3x.ObjectRegistry.register","lg3x.ObjectRegistry.invoke","lg3x.ClassRegistry","lg3x.ClassRegistry.constructor","lg3x.ClassRegistry.register","lg3x.ClassRegistry.invoke","lg3x.RPC","lg3x.RPC.constructor","lg3x.RPC.Response","lg3x.RPC.Request","lg3x.RPC.Error","lg3x.WSRpcContext","lg3x.WSRpcContext.constructor","lg3x.WSRpcLogging","lg3x.WSRpcLogging.constructor","lg3x.WSRpcLogging.log","lg3x.WSRpcInvoke","lg3x.WSRpcInvoke.constructor","lg3x.WSRpcInvoke.method","lg3x.WSRpcMethod","lg3x.WSRpcMethod.constructor","lg3x.WSRpcMethod.withParams","lg3x.WSRpcMethodRequest","lg3x.WSRpcMethodRequest.constructor","lg3x.WSRpcMethodRequest.broadcast","lg3x.WSRpcMethodRequest.now","lg3x.WSRpcMethodRequest.then","lg3x.WSRpc","lg3x.WSRpc.constructor","lg3x.WSRpc.connect","lg3x.WSRpc.close","lg3x.WSRpc.onOpen","lg3x.WSRpc.onClose","lg3x.WSRpc.onError","lg3x.WSRpc.onConnect","lg3x.WSRpc.call","lg3x.WSRpc.on","lg3x.WSRpc.doRequest","lg3x.WSRpc.onResponse"],"mappings":"AAAA,IAAc,IAAI,CA8cjB;AA9cD,WAAc,IAAI,EAAC,CAAC;IAELA,UAAKA,GAAYA,KAAKA,CAACA;IAwClCA,IAAaA,aAAaA;QAA1BC,SAAaA,aAAaA;QAU1BC,CAACA;QARiBD,0BAAYA,GAA1BA;YACIE,IAAIA,CAACA,GAAGA,IAAIA,IAAIA,EAAEA,CAACA,OAAOA,EAAEA,CAACA;YAC7BA,MAAMA,CAACA,sCAAsCA,CAACA,OAAOA,CAACA,OAAOA,EAAEA,UAAUA,CAACA;gBACtE,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;gBAC1C,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;gBACvB,MAAM,CAAC,CAAC,CAAC,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;YACzD,CAAC,CAACA,CAACA;QACPA,CAACA;QACLF,oBAACA;IAADA,CAVAD,AAUCC,IAAAD;IAVYA,kBAAaA,GAAbA,aAUZA,CAAAA;IAEDA,IAAaA,QAAQA;QAMjBI,SANSA,QAAQA;YAITC,cAASA,GAAmDA,EAAEA,CAACA;YAGnEA,EAAEA,CAACA,CAACA,QAAQA,CAACA,SAASA,CAACA,CAACA,CAACA;gBACrBA,MAAMA,IAAIA,KAAKA,CAACA,6BAA6BA,CAACA,CAACA;YACnDA,CAACA;YACDA,QAAQA,CAACA,SAASA,GAAGA,IAAIA,CAACA;QAC9BA,CAACA;QAEaD,0BAAiBA,GAA/BA;YACIE,EAAEA,CAACA,CAACA,QAAQA,CAACA,SAASA,KAAKA,IAAIA,CAACA,CAACA,CAACA;gBAC9BA,QAAQA,CAACA,SAASA,GAAGA,IAAIA,QAAQA,EAAEA,CAACA;YACxCA,CAACA;YACDA,MAAMA,CAACA,QAAQA,CAACA,SAASA,CAACA;QAC9BA,CAACA;QAEDF,qBAAEA,GAAFA,UAAGA,OAAcA,EAAEA,QAA6BA;YAC5CG,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA,SAASA,CAACA,OAAOA,CAACA,CAACA,CAACA,CAACA;gBAC3BA,IAAIA,CAACA,SAASA,CAACA,OAAOA,CAACA,GAAGA,CAACA,QAAQA,CAACA,CAACA;gBACrCA,MAAMA,CAACA;YACXA,CAACA;YAEDA,IAAIA,CAACA,SAASA,CAACA,OAAOA,CAACA,CAACA,IAAIA,CAACA,QAAQA,CAACA,CAACA;QAC3CA,CAACA;QAEDH,uBAAIA,GAAJA,UAAKA,OAAcA,EAAEA,IAAUA;YAC3BI,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,IAAIA,IAAIA,CAACA,SAASA,CAACA,OAAOA,CAACA,CAACA,CAACA,CAACA;gBACpCA,IAAIA,MAAMA,GAAGA,IAAIA,CAACA,SAASA,CAACA,OAAOA,CAACA,CAACA,CAACA,CAACA,CAACA;gBACxCA,EAAEA,CAACA,CAACA,MAAMA,CAACA,CAACA,CAACA;oBACTA,UAAUA,CAACA,MAAMA,CAACA,IAAIA,CAACA,CAACA,CAACA;gBAC7BA,CAACA;YACLA,CAACA;QACLA,CAACA;QAEDJ,yBAAMA,GAANA,UAAOA,OAAcA,EAAEA,QAA6BA;YAChDK,EAAEA,CAACA,CAACA,IAAIA,CAACA,SAASA,CAACA,OAAOA,CAACA,CAACA,CAACA,CAACA;gBAC1BA,IAAIA,GAAGA,GAAWA,IAAIA,CAACA,SAASA,CAACA,OAAOA,CAACA,CAACA,MAAMA,CAACA;gBACjDA,IAAIA,YAAYA,GAA0BA,CAACA,UAACA,IAAUA;gBAAWA,CAACA,CAACA,CAACA;gBACpEA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,GAAGA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBAC3BA,IAAIA,SAASA,GAAwBA,IAAIA,CAACA,SAASA,CAACA,OAAOA,CAACA,CAACA,CAACA,CAACA,CAACA;oBAChEA,EAAEA,CAACA,CAACA,SAASA,KAAKA,QAAQA,CAACA,CAACA,CAACA;oBAC7BA,CAACA;oBAACA,IAAIA,CAACA,CAACA;wBACJA,YAAYA,CAACA,IAAIA,CAACA,SAASA,CAACA,CAACA;oBACjCA,CAACA;gBACLA,CAACA;gBACDA,IAAIA,CAACA,SAASA,CAACA,OAAOA,CAACA,GAAGA,YAAYA,CAACA;YAC3CA,CAACA;QACLA,CAACA;QAjDcL,kBAASA,GAAaA,IAAIA,CAACA;QAkD9CA,eAACA;IAADA,CApDAJ,AAoDCI,IAAAJ;IApDYA,aAAQA,GAARA,QAoDZA,CAAAA;IAEDA,IAAaA,SAASA;QAUlBU,SAVSA,SAASA,CAUNA,GAAGA;YACXC,EAAEA,CAACA,CAACA,GAAGA,CAACA,OAAOA,KAAKA,KAAKA,CAACA,CAACA,CAACA;gBACxBA,MAAMA,yBAAyBA,CAACA;YACpCA,CAACA;YACDA,IAAIA,CAACA,GAAGA,GAAGA,GAAGA,CAACA,EAAEA,CAACA;YAClBA,IAAIA,CAACA,UAAUA,GAAGA,KAAKA,CAACA;YACxBA,EAAEA,CAACA,CAACA,GAAGA,CAACA,KAAKA,CAACA,CAACA,CAACA;gBACZA,IAAIA,CAACA,KAAKA,GAAGA,GAAGA,CAACA,KAAKA,CAACA,IAAIA,CAACA;gBAC5BA,IAAIA,CAACA,QAAQA,GAAGA,GAAGA,CAACA,KAAKA,CAACA,OAAOA,CAACA;YACtCA,CAACA;YACDA,IAAIA,CAACA,EAAEA,CAACA,CAACA,GAAGA,CAACA,MAAMA,CAACA,CAACA,CAACA;gBAClBA,IAAIA,CAACA,OAAOA,GAAGA,GAAGA,CAACA,MAAMA,CAACA;YAC9BA,CAACA;YACDA,IAAIA,CAACA,CAACA;gBACFA,IAAIA,CAACA,OAAOA,GAAGA,GAAGA,CAACA,MAAMA,CAACA;gBAC1BA,IAAIA,CAACA,GAAGA,GAAGA,CAACA,MAAMA,CAACA,KAAKA,CAACA,GAAGA,CAACA,CAACA;gBAC9BA,IAAIA,CAACA,YAAYA,GAAGA,CAACA,CAACA,CAACA,CAACA,MAAMA,GAAGA,CAACA,CAACA,CAACA;gBACpCA,IAAIA,CAACA,cAAcA,GAAGA,IAAIA,CAACA;gBAC3BA,EAAEA,CAACA,CAACA,CAACA,CAACA,CAACA,CAACA,CAACA,KAAKA,CAACA,GAAGA,CAACA,CAACA,CAACA,CAACA,KAAKA,YAAYA,CAACA,CAACA,CAACA;oBACtCA,IAAIA,CAACA,UAAUA,GAAGA,IAAIA,CAACA;oBACvBA,IAAIA,CAACA,cAAcA,GAAGA,CAACA,CAACA,CAACA,CAACA,CAACA,KAAKA,CAACA,GAAGA,CAACA,CAACA,CAACA,CAACA,CAACA;gBAC7CA,CAACA;gBAACA,IAAIA,CAACA,CAACA;oBACJA,IAAIA,CAACA,cAAcA,GAAGA,CAACA,CAACA,CAACA,CAACA,CAACA;gBAC/BA,CAACA;YACLA,CAACA;QACLA,CAACA;QAEDD,2BAAOA,GAAPA;YACIE,MAAMA,CAACA,CAACA,IAAIA,CAACA,KAAKA,KAAKA,SAASA,CAACA,CAACA;QACtCA,CAACA;QAEDF,6BAASA,GAATA;YACIG,MAAMA,CAACA,CAACA,IAAIA,CAACA,YAAYA,KAAKA,SAASA,CAACA,CAACA;QAC7CA,CAACA;QAEDH,8BAAUA,GAAVA;YACII,MAAMA,CAACA,CAACA,IAAIA,CAACA,OAAOA,IAAIA,SAASA,CAACA,CAACA;QACvCA,CAACA;QAEDJ,2BAAOA,GAAPA;YACIK,MAAMA,CAACA,IAAIA,CAACA,KAAKA,CAACA;QACtBA,CAACA;QAEDL,mCAAeA,GAAfA;YACIM,MAAMA,CAACA,IAAIA,CAACA,QAAQA,CAACA;QACzBA,CAACA;QAEDN,6BAASA,GAATA;YACIO,MAAMA,CAACA,IAAIA,CAACA,OAAOA,CAACA;QACxBA,CAACA;QAEDP,6BAASA,GAATA;YACIQ,MAAMA,CAACA,IAAIA,CAACA,OAAOA,CAACA;QACxBA,CAACA;QAEDR,+BAAWA,GAAXA;YACIS,MAAMA,CAACA,IAAIA,CAACA,UAAUA,CAACA;QAC3BA,CAACA;QAEDT,6BAASA,GAATA;YACIU,MAAMA,CAACA,IAAIA,CAACA,YAAYA,CAACA;QAC7BA,CAACA;QAEDV,oCAAgBA,GAAhBA;YACIW,MAAMA,CAACA,IAAIA,CAACA,cAAcA,CAACA;QAC/BA,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","file":"WSRpc.js","sourceRoot":"/Users/lionel/Projects/Personnel/WSRpc/","sourcesContent":["export module lg3x {\n\n    export var DEBUG: boolean = false;\n\n    export module api {\n\n        export interface IRPCRegistry {\n            register(name: string, classname: any);\n            invoke(name: string, method: string, params?: any): any;\n        }\n\n        export interface IWSRpc {\n            connect();\n            close(): boolean;\n\n            onOpen(callback: (event: Event) => void);\n            onClose(callback: (event: CloseEvent) => void);\n            onError(callback: (event: ErrorEvent) => void);\n            onConnect(callback: () => void);\n\n            doRequest(action: string, data: JSON, ...callbacks: ((data: JSON) => void)[]);\n            onResponse(action: string, ...callbacks: ((data: JSON) => void)[]);\n\n            call(about?: string): IWSRpcInvoke;\n            on(about: string, ...callbacks: ((data: JSON) => void)[]);\n        }\n\n        export interface IWSRpcInvoke {\n            method(method: string): IWSRpcMethod;\n        }\n\n        export interface IWSRpcMethod {\n            withParams(params?: JSON): IWSRpcMethodRequest;\n        }\n\n        export interface IWSRpcMethodRequest {\n            broadcast(): IWSRpcMethodRequest;\n            now();\n            then(...callbacks: ((data: JSON) => void)[]);\n        }\n    }\n\n    export class UUIDGenerator {\n\n        public static generateUUID(): string {\n            var d = new Date().getTime();\n            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n                var r = (d + Math.random() * 16) % 16 | 0;\n                d = Math.floor(d / 16);\n                return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n            });\n        }\n    }\n\n    export class EventBus {\n\n        private static _instance: EventBus = null;\n\n        private listeners: { [eventId: string]: [(data: JSON)=> void] ; } = {};\n\n        constructor() {\n            if (EventBus._instance) {\n                throw new Error('Instantiate EventBus error.');\n            }\n            EventBus._instance = this;\n        }\n\n        public static getSharedEventBus(): EventBus {\n            if (EventBus._instance === null) {\n                EventBus._instance = new EventBus();\n            }\n            return EventBus._instance;\n        }\n\n        on(eventId:string, callback:(data: JSON) => void) {\n            if (!this.listeners[eventId]) {\n                this.listeners[eventId] = [callback];\n                return;\n            }\n            //this.listeners[eventId][this.listeners[eventId].length] = callback;\n            this.listeners[eventId].push(callback);\n        }\n\n        fire(eventId:string, data?:JSON) {\n            for (var x in this.listeners[eventId]) {\n                var method = this.listeners[eventId][x];\n                if (method) {\n                    setTimeout(method(data));\n                }\n            }\n        }\n\n        remove(eventId:string, callback:(data: JSON) => void) {\n            if (this.listeners[eventId]) {\n                var len: number = this.listeners[eventId].length;\n                var newcallbacks: [(data: JSON)=> void] = [(data: JSON): void=> {}];\n                for (var x = 0; x < len; x++) {\n                    var _callback: (data: JSON)=> void = this.listeners[eventId][x];\n                    if (_callback === callback) {\n                    } else {\n                        newcallbacks.push(_callback);\n                    }\n                }\n                this.listeners[eventId] = newcallbacks;\n            }\n        }\n    }\n\n    export class RPCParser {\n        _code: number;\n        _message: string;\n        _id: string;\n        _broadcast: boolean;\n        _namedMethod: string;\n        _namedInstance: string;\n        _result: JSON;\n        _params: JSON;\n\n        constructor(rpc) {\n            if (rpc.jsonrpc !== '2.0') {\n                throw 'RPC Method Parser Error';\n            }\n            this._id = rpc.id;\n            this._broadcast = false;\n            if (rpc.error) {\n                this._code = rpc.error.code;\n                this._message = rpc.error.message;\n            }\n            else if (rpc.result) {\n                this._result = rpc.result;\n            }\n            else {\n                this._params = rpc.params;\n                var t = rpc.method.split('.');\n                this._namedMethod = t[t.length - 1];\n                this._namedInstance = null;\n                if (t[0].split('}')[0] === '{broadcast') {\n                    this._broadcast = true;\n                    this._namedInstance = t[0].split('}')[1];\n                } else {\n                    this._namedInstance = t[0];\n                }\n            }\n        }\n\n        isError(): boolean {\n            return (this._code !== undefined);\n        }\n\n        isRequest(): boolean {\n            return (this._namedMethod !== undefined);\n        }\n\n        isResponse(): boolean {\n            return (this._result != undefined);\n        }\n\n        getCode(): number {\n            return this._code;\n        }\n\n        getErrorMessage(): string {\n            return this._message;\n        }\n\n        getResult(): JSON {\n            return this._result;\n        }\n\n        getParams(): JSON {\n            return this._params;\n        }\n\n        isBroadcast(): boolean {\n            return this._broadcast;\n        }\n\n        getMethod(): string {\n            return this._namedMethod;\n        }\n\n        getNamedInstance(): string {\n            return this._namedInstance;\n        }\n\n        getId(): string {\n            return this._id;\n        }\n    }\n\n    export class ObjectRegistry implements api.IRPCRegistry {\n        private _objects: { [name: string]: Object } = {};\n        constructor() {}\n\n        register(name: string, className: any) {\n            this._objects[name] = new className();\n        }\n\n        invoke(name: string, method: string, params?: any): any {\n            try {\n                var instance = this._objects[name];\n                return instance[method](params);\n            } catch (err) {\n                var msg: string = 'ObjectRegistry invoke fail on ' + name + '.' + method;\n                msg += (params) ? '(' + JSON.stringify(params) + ')' : '()';\n                throw (msg);\n            }\n        }\n    }\n\n    export class ClassRegistry implements api.IRPCRegistry {\n        private _classNames: { [name: string]: any } = {};\n        constructor() {}\n\n        register(name: string, className: any) {\n            this._classNames[name] = className;\n        }\n\n        invoke(name: string, method: string, params?: any): any {\n            try {\n                var instance = new this._classNames[name];\n                return instance[method](params);\n            } catch (err) {\n                var msg: string = 'ClassRegistry invoke fail on ' + name + '.' + method;\n                msg += (params) ? '(' + JSON.stringify(params) + ')' : '()';\n                throw (msg);\n            }\n        }\n    }\n\n    export class RPC {\n\n        public static VERSION: string = '2.0';\n        public static PARSE_ERROR: number = -32700;\n        public static INVALID_REQUEST: number = -32600;\n        public static METHOD_NOT_FOUND: number = -32601;\n        public static INVALID_PARAMS: number = -32602;\n        public static INTERNAL_ERROR: number = -32603;\n\n        public static Response(id:string, result?:JSON) {\n            return {\n                'jsonrpc': RPC.VERSION,\n                'result': (result) ? result : null,\n                'id': (id) ? id : null\n            }\n        }\n\n        public static Request(id:string, method:string, data?:JSON) {\n            return {\n                'jsonrpc': RPC.VERSION,\n                'method': method,\n                'params': data,\n                'id': (id) ? id : null\n            };\n        }\n\n        public static Error(id:string, code:number, message:string) {\n            return {\n                'jsonrpc': RPC.VERSION,\n                'error': {\n                    'code': code,\n                    'message' : message\n                },\n                'id': (id) ? id : null\n            };\n        }\n    }\n\n    export class WSRpcContext {\n        ws:         WebSocket;\n        id:         string;\n        action:     string;\n        method:     string;\n        data:       JSON;\n        broadcast:  boolean;\n    }\n\n    export class WSRpcLogging {\n        static log(...args: any[]) {\n            if (lg3x.DEBUG) {\n                console.debug.apply(console, args);\n            }\n        }\n    }\n\n    export class WSRpcInvoke implements api.IWSRpcInvoke {\n        private _context: WSRpcContext;\n        constructor(context: WSRpcContext) {\n            this._context = context;\n        }\n        method(method: string): api.IWSRpcMethod {\n            this._context.method = method;\n            return new WSRpcMethod(this._context);\n        }\n    }\n\n    export class WSRpcMethod implements api.IWSRpcMethod {\n        private _context: WSRpcContext;\n        constructor(context: WSRpcContext) {\n            this._context = context;\n        }\n        withParams(params?: JSON): api.IWSRpcMethodRequest {\n            this._context.data = params;\n            return new WSRpcMethodRequest(this._context);\n        }\n    }\n\n    export class WSRpcMethodRequest implements api.IWSRpcMethodRequest {\n        private _context: WSRpcContext;\n        constructor(context: WSRpcContext) {\n            this._context = context;\n        }\n        broadcast(): WSRpcMethodRequest {\n            this._context.broadcast = true;\n            return this;\n        }\n        now() {\n            var _rpc = RPC.Request(this._context.id, this._context.method, this._context.data);\n            if (this._context.ws) {\n                WSRpcLogging.log('WSRpc', 'now', this._context.ws.url, JSON.stringify(_rpc));\n                return this._context.ws.send(JSON.stringify(_rpc));\n            } else {\n                throw 'WS send error: connection may be closed';\n            }\n        }\n        then(...callbacks:((data: JSON) => void)[]) {\n            this._context.id =  this._context.method + ':' + UUIDGenerator.generateUUID();\n            if (callbacks && callbacks.length > 0) {\n                var eventBus: EventBus = EventBus.getSharedEventBus();\n                for (var x = 0; x < callbacks.length; x++) {\n                    eventBus.on(this._context.id, callbacks[x]);\n                }\n            }\n            this.now();\n        }\n    }\n\n    export class WSRpc implements api.IWSRpc {\n\n        private _ws: WebSocket;\n        private _url: string;\n\n        private _onOpenCallback: (event: Event) => void;\n        private _onCloseCallback: (event: CloseEvent) => void;\n        private _onErrorCallback: (event: ErrorEvent) => void;\n        private _onConnectCallback: () => void;\n\n        constructor(url: string) {\n            this._url = url;\n        }\n\n        public connect() {\n            WSRpcLogging.log('WSRpc', 'connecting ...', this._url);\n            this._ws = new WebSocket(this._url, ['jsonrpc_2.0_over_websocket']);\n\n            if (this._onConnectCallback) {\n                setTimeout(this._onConnectCallback(), 0);\n            }\n\n            this._ws.onopen = (event: Event) => {\n                WSRpcLogging.log('WSRpc', 'onOpen', this._url);\n                if (this._onOpenCallback) {\n                    setTimeout(this._onOpenCallback(event), 0);\n                }\n            };\n\n            this._ws.onclose = (event: CloseEvent) => {\n                WSRpcLogging.log('WSRpc', 'onclose', this._url);\n                if (this._onCloseCallback) {\n                    setTimeout(this._onCloseCallback(event), 0);\n                }\n            };\n\n            this._ws.onmessage = (event) => {\n                WSRpcLogging.log('WSRpc', 'onmessage', this._url, event.data);\n                var rpc = JSON.parse(event.data);\n                if (rpc.jsonrpc && rpc.jsonrpc === RPC.VERSION && rpc.id) {\n                    EventBus.getSharedEventBus().fire(rpc.id, rpc.result);\n                }\n            };\n\n            this._ws.onerror = (event) => {\n                WSRpcLogging.log('WSRpc', 'onerror', this._url, event);\n                if (this._onErrorCallback) {\n                    setTimeout(this._onErrorCallback(event), 0);\n                }\n            };\n        }\n\n        public close():boolean {\n            if (this._ws) {\n                this._ws.close();\n                this._ws = null;\n                return true;\n            }\n            return false;\n        }\n\n        onOpen(callback:(event: Event) => void) {\n            this._onOpenCallback = callback;\n        }\n\n        onClose(callback:(event: CloseEvent) => void) {\n            this._onCloseCallback = callback;\n        }\n\n        onError(callback:(event: ErrorEvent) => void) {\n            this._onErrorCallback = callback;\n        }\n\n        onConnect(callback:() => void) {\n            this._onConnectCallback = callback;\n        }\n\n        call(about?: string): api.IWSRpcInvoke {\n            var wsCtx: WSRpcContext = new WSRpcContext();\n            wsCtx.ws = this._ws;\n            wsCtx.id = about;\n            return new WSRpcInvoke(wsCtx);\n        }\n\n        on(about: string, ...callbacks: ((data: JSON) => void)[]) {\n            WSRpcLogging.log('Setting callback for', '\"' + about + '\"');\n            if (callbacks && callbacks.length > 0) {\n                var eventBus: EventBus = EventBus.getSharedEventBus();\n                for (var x = 0; x < callbacks.length; x++) {\n                    eventBus.on(about, callbacks[x]);\n                }\n            }\n        }\n\n        doRequest(action: string, data: JSON, ...callbacks: ((data: JSON) => void)[]) {\n            var _rpc = null;\n            if (callbacks && callbacks.length > 0) {\n                var _uuid: string =  action + ':' + UUIDGenerator.generateUUID();\n                var eventBus: EventBus = EventBus.getSharedEventBus();\n                for (var x = 0; x < callbacks.length; x++) {\n                    eventBus.on(_uuid, callbacks[x]);\n                }\n                _rpc = RPC.Request(_uuid, action, data);\n            } else {\n                _rpc = RPC.Request(action, action, data);\n            }\n\n            if (this._ws) {\n                WSRpcLogging.log('WSRpc', 'send', this._ws.url, JSON.stringify(_rpc));\n                return this._ws.send(JSON.stringify(_rpc));\n            } else {\n                throw 'WS send error: connection may be closed';\n            }\n        }\n\n        onResponse(action: string, ...callbacks: ((data: JSON) => void)[]) {\n            if (callbacks && callbacks.length > 0) {\n                var eventBus: EventBus = EventBus.getSharedEventBus();\n                for (var x = 0; x < callbacks.length; x++) {\n                    eventBus.on(action, callbacks[x]);\n                }\n            }\n        }\n    }\n\n}\n"]}