{"version":3,"sources":["WSRpcBackend.ts"],"names":["WSRpcLogging","WSRpcLogging.constructor","WSRpcLogging.log","WSRpcLogging.error","WSRpcBackend","WSRpcBackend.constructor","WSRpcBackend.link","WSRpcBackend.singleton","WSRpcBackend.stateless","WSRpcBackend.statefull","WSRpcBackend._onClientConnect","WSRpcBackend._onClientClose","WSRpcBackend._onClientPingPongMessage","WSRpcBackend._onClientError","WSRpcBackend._onClientOpen","WSRpcBackend._onServerError","WSRpcBackend._onServerHeaders","WSRpcBackend._onClientMessage","WSRpcServerCallHandler","WSRpcServerCallHandler.constructor","WSRpcServerCallHandler.singleton","WSRpcServerCallHandler.stateless","WSRpcServerCallHandler.statefull","WSRpcServerCallHandler.getRegistry","WSRpcServerCallHandler.rpcInvoke","WSRpcServerCallHandler.broadcastRpcInvoke","WSRpcServerCallHandler.sendResponseToOrigin","WSRpcServerCallHandler.sendErrorToOrigin","WSRpcServerCallHandler.useResponse","WSRpcServerCallHandler.receiveClientError","WSRpcServerCallHandler.getClientResponseWithId"],"mappings":"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","file":"WSRpcBackend.js","sourcesContent":["/// <reference path=\"../typings/ws/ws.d.ts\" />\n/// <reference path=\"WSRpc.ts\" />\n\nimport ws = require('ws');\nimport rpc = require('./WSRpc');\n\nexport var DEBUG: boolean = false;\n\nexport module api {\n\n    export interface IWSRpcBackend {\n        link(server: ws.Server);\n        singleton(instanceName: string, classNames: any);\n        stateless(instanceName: string, classNames: any);\n        statefull(instanceName: string, classNames: any);\n    }\n}\n\nclass WSRpcLogging {\n    static log(...args: any[]) {\n        if (DEBUG) {\n            console.log(args);\n        }\n    }\n    static error(...args: any[]) {\n        console.warn(args);\n    }\n}\n\nexport class WSRpcBackend implements api.IWSRpcBackend {\n\n    private _server: ws.Server;\n    private _handler: WSRpcServerCallHandler;\n\n    constructor() {\n        this._handler = new WSRpcServerCallHandler();\n    }\n\n    public link(server: ws.Server) {\n        this._server = server;\n        this._server.on('error', (err: Error) => {\n                this._onServerError(err);\n            }\n        );\n\n        this._server.on('headers', (headers: string[]) => {\n                this._onServerHeaders(headers);\n            }\n        );\n\n        this._server.on('connection', (client) => {\n                this._onClientConnect(client);\n            }\n        );\n    }\n\n    public singleton(instanceName: string, classNames: any) {\n        this._handler.singleton(instanceName, classNames);\n    }\n\n    public stateless(instanceName: string, classNames: any) {\n        this._handler.stateless(instanceName, classNames);\n    }\n\n    public statefull(instanceName: string, classNames: any) {\n        this._handler.statefull(instanceName, classNames);\n    }\n\n    private _onClientConnect(client: any) {\n        client.on('message', (data: any, flags: {binary: boolean}) => {\n                this._onClientMessage(client, data, flags);\n            }\n        );\n        client.on('error', (err: Error) => {\n                this._onClientError(client, err);\n            }\n        );\n        client.on('close', (code: number, message: string) => {\n                this._onClientClose(client, code, message);\n            }\n        );\n        client.on('ping', (data: any, flags: {binary: boolean}) => {\n                this._onClientPingPongMessage(client, data, flags, true);\n            }\n        );\n        client.on('pong', (data: any, flags: {binary: boolean}) => {\n                this._onClientPingPongMessage(client, data, flags, false);\n            }\n        );\n        client.on('open', () => {\n                this._onClientOpen(client);\n            }\n        );\n    }\n\n    private _onClientClose(client: WebSocket, code: number, message: string) {\n        WSRpcLogging.log('Client close code ' + code + \", message \" + message);\n    }\n\n    private _onClientPingPongMessage(client: WebSocket, data: any, flags: {binary: boolean}, ping: boolean) {\n        WSRpcLogging.log('Ping Pong ' + data);\n    }\n\n    private _onClientError(client: WebSocket, err: Error) {\n        WSRpcLogging.log('Client error ' + err);\n    }\n\n    private _onClientOpen(client: WebSocket) {\n        WSRpcLogging.log('Client open ');\n    }\n\n    private _onServerError(err: Error) {\n        WSRpcLogging.log('Server err ' + err);\n    }\n\n    private _onServerHeaders(headers: string[]) {\n        WSRpcLogging.log('Server headers ');\n        headers.forEach(function (h) {\n            WSRpcLogging.log(h)\n        });\n    }\n\n    public _onClientMessage(client: WebSocket, data: any, flags: {binary: boolean}) {\n        WSRpcLogging.log('>> ' + data);\n        try {\n            var _rpc: rpc.RpcMessage = new rpc.RpcMessage(JSON.parse(data));\n            if (_rpc.isRequest() && _rpc.isBroadcast()) {\n                this._handler.broadcastRpcInvoke(\n                    this._server,\n\t\t\t\t\tclient,\n                    _rpc.getAction(),\n                    _rpc.getInstance(),\n                    _rpc.getMethod(),\n                    _rpc.getParams(),\n                    _rpc.getId()\n                );\n            }\n            else if (_rpc.isRequest()) {\n                this._handler.rpcInvoke(\n                    client,\n                    _rpc.getInstance(),\n                    _rpc.getMethod(),\n                    _rpc.getParams(),\n                    _rpc.getId()\n                );\n            }\n            else if (_rpc.isResponse() && this._handler.getClientResponseWithId(_rpc.getId())) {\n                this._handler.sendResponseToOrigin(_rpc.getId(), _rpc.getResult());\n            }\n            else if (_rpc.isResponse()) {\n                this._handler.useResponse(_rpc.getId(), _rpc.getResult());\n            }\n            else if (_rpc.isError() && this._handler.getClientResponseWithId(_rpc.getId())) {\n                this._handler.sendErrorToOrigin(_rpc.getId(), _rpc.getCode(), _rpc.getErrorMessage());\n            }\n            else if (_rpc.isError()) {\n                this._handler.receiveClientError(_rpc);\n            }\n        } catch (err) {\n            console.warn(err);\n        }\n    }\n}\n\nexport class WSRpcServerCallHandler {\n\n    private _singleton: rpc.ObjectRegistry;\n    private _stateless: rpc.ClassRegistry;\n    private _names: { [name: string]: Object };\n\tprivate _eventBus: rpc.EventBus;\n\tprivate _pendingRequest: { [id: string]: any };\n\n\tconstructor() {\n        this._names = {};\n        this._singleton = new rpc.ObjectRegistry();\n        this._stateless = new rpc.ClassRegistry();\n\t\tthis._pendingRequest = {};\n\t\tthis._eventBus = rpc.EventBus.getSharedEventBus();\n    }\n\n    public singleton(instanceName: string, classNames: any) {\n        this._names[instanceName] = this._singleton;\n        this._singleton.register(instanceName, classNames);\n    }\n\n    public stateless(instanceName: string, classNames: any) {\n        this._names[instanceName] = this._stateless;\n        this._stateless.register(instanceName, classNames);\n    }\n\n    public statefull(instanceName: string, classNames: any) {\n        console.warn('Session objects not implemented yet !');\n    }\n\n    public getRegistry(instanceName: string): rpc.api.IRPCRegistry {\n        if (this._names[instanceName] === this._singleton) {\n            return this._singleton;\n        }\n        else if (this._names[instanceName] === this._stateless) {\n            return this._stateless;\n        }\n        return null;\n    }\n\n    public rpcInvoke(client: WebSocket, instance: string, method: string, params: JSON, id: string) {\n        if (this._names[instance]) {\n            var registry: rpc.api.IRPCRegistry = null;\n            if (this._names[instance] === this._singleton) {\n                registry = this._singleton;\n            }\n            else if (this._names[instance] === this._stateless) {\n                registry = this._stateless;\n            }\n\t\t\ttry {\n\t\t\t\tvar result: JSON = registry.invoke(instance, method, params);\n\t\t\t\tclient.send(JSON.stringify(rpc.RPC.Response(id, result)));\n\t\t\t} catch (err) {\n\t\t\t\tconsole.warn('RPC server call \"' + instance + '.' + method + '\" fail.');\n\t\t\t\tWSRpcLogging.error('<< ' + JSON.stringify(rpc.RPC.Error('Error', rpc.RPC.INTERNAL_ERROR,\n\t\t\t\t\t'RPC server call \"' + instance + '.' + method + '\" fail.')));\n\t\t\t\tclient.send(JSON.stringify(rpc.RPC.Error('Error', rpc.RPC.INTERNAL_ERROR,\n\t\t\t\t\t'RPC server call \"' + instance + '.' + method + '\" fail.')));\n\t\t\t}\n        }\n        else {\n            client.send(\n                JSON.stringify(\n                    rpc.RPC.Error(id, rpc.RPC.METHOD_NOT_FOUND, 'RPC server instance named ' + instance + ' not found.')\n                )\n            );\n        }\n    }\n\n    public broadcastRpcInvoke(server: ws.Server, client: WebSocket, action: string, instance: string, method: string, params: JSON, id: string) {\n\t\tif (id) {\n\t\t\tthis._pendingRequest[id] = client;\n\t\t}\n\t\tvar m: string = (action) ? action : instance + '.' + method;\n\t\tvar newRpc = rpc.RPC.Request(id, m, params);\n\t\tserver.clients.forEach((_client) => {\n\t\t\t_client.send(JSON.stringify(newRpc));\n\t\t});\n    }\n\n    public sendResponseToOrigin(id: string, result: JSON) {\n        if (id && this._pendingRequest[id]) {\n\t\t\tvar newRpc = rpc.RPC.Response(id, result);\n\t\t\tvar client = this._pendingRequest[id];\n\t\t\tclient.send(JSON.stringify(newRpc));\n\t\t}\n    }\n\n    public sendErrorToOrigin(id: string, code: number, message: string) {\n\t\tif (id && this._pendingRequest[id]) {\n\t\t\tvar newRpc = rpc.RPC.Error(id, code, message);\n\t\t\tvar client = this._pendingRequest[id];\n\t\t\tclient.send(JSON.stringify(newRpc));\n\t\t}\n\t}\n\n    public useResponse(id: string, result: JSON) {\n        this._eventBus.fire(id, result);\n    }\n\n    public receiveClientError(rpc: rpc.RpcMessage) {\n        WSRpcLogging.error('Get error : ' + JSON.stringify(rpc));\n\t}\n\n    public getClientResponseWithId(id: string): any {\n        return this._pendingRequest[id];\n    }\n}"],"sourceRoot":"/source/"}